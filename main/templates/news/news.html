{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/news.css' %}">
{% endblock %}
{% block content %}
    <div class="news-page">
        <h1 class="page-title">Новости</h1>
        <!-- Поиск по новостям -->
        <div class="news-search">
            <form method="get" action="{% url 'news' %}">
                <input
                        type="text"
                        name="q"
                        placeholder="Поиск по новостям..."
                        value="{{ search_query|default:'' }}"
                >
                <button type="submit">Найти</button>
            </form>
        </div>

        <div class="news-list">
            {% for news_item in page_obj %}
                <div class="news-item {% if news_item.featured_image %}with-image{% else %}no-image{% endif %}">
                    {% with featured_image=news_item.featured_image %}
                        {% if featured_image %}
                            <div class="news-image-container">
                                <img src="{{ featured_image.image.url }}" alt="{{ news_item.title }}"
                                     class="news-image">
                            </div>
                        {% endif %}
                    {% endwith %}

                    <div class="news-content">
                        <h2 class="news-title">{{ news_item.title }}</h2>

                        <div class="news-meta">
                            {% if news_item.author %}
                                <span class="news-author">
                        <i class="fas fa-user"></i> {{ news_item.author.get_full_name|default:news_item.author.username }}
                    </span>
                            {% endif %}
                            <span class="news-date">
                        <i class="far fa-clock"></i> {{ news_item.get_local_date }}
                    </span>
                        </div>

                        <div class="news-excerpt">
                            {{ news_item.content|truncatewords:30|striptags }}
                        </div>

                        <a href="{% url 'news_detail' news_item.id %}" class="read-more">
                            Читать далее <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
        <!-- Пагинация -->
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if search_query %}&q={{ search_query }}{% endif %}">Первая</a>
                <a href="?page=
                        {{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">Назад</a>
            {% endif %}

            <span class="current-page">
                Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">Вперед</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&q={{ search_query }}{% endif %}">Последняя</a>
            {% endif %}
        </div>
    </div>

    <!-- Подключаем Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}